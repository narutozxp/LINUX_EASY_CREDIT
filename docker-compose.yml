version: '3.8'

services:
  # Web 服务（Nginx + PHP-FPM）
  web:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: reward-website
    restart: unless-stopped
    ports:
      - "${WEB_PORT:-80}:80"
    volumes:
      # 挂载配置文件（持久化）
      - ./config/config.php:/var/www/html/config/config.php:ro
      # 挂载日志目录（持久化）
      - ./logs:/var/www/html/logs
      # 可选：挂载自定义主题
      # - ./assets:/var/www/html/assets
    environment:
      # PHP 配置
      - PHP_MEMORY_LIMIT=256M
      - PHP_MAX_EXECUTION_TIME=300
      - PHP_UPLOAD_MAX_FILESIZE=10M
      - PHP_POST_MAX_SIZE=10M
      # 时区设置
      - TZ=Asia/Shanghai
    networks:
      - reward-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/index.html"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 10s

networks:
  reward-network:
    driver: bridge

# 数据卷（可选，用于持久化数据）
volumes:
  logs:
    driver: local
